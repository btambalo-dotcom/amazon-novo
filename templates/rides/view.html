{% extends 'base.html' %}
{% block content %}
<h1>Corrida</h1>
<form method="post" class="mb-4">
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Título</label>
      <input name="titulo" class="form-control" value="{{ ride.titulo or '' }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Início</label>
      <input type="datetime-local" name="inicio" class="form-control" required value="{{ ride.inicio.strftime('%Y-%m-%dT%H:%M') }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Fim</label>
      <input type="datetime-local" name="fim" class="form-control" required value="{{ ride.fim.strftime('%Y-%m-%dT%H:%M') }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Valor</label>
      <input type="number" step="0.01" name="valor" class="form-control" value="{{ ride.valor }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Gorjeta</label>
      <input type="number" step="0.01" name="gorjeta" class="form-control" value="{{ ride.gorjeta }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Estação</label>
      <select name="station_id" class="form-select">
        <option value="">—</option>
        {% for e in estacoes %}
          <option value="{{e.id}}" {% if ride.station_id==e.id %}selected{% endif %}>{{ e.nome }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3 form-check mt-4">
      <input class="form-check-input" type="checkbox" name="exclude_from_reports" id="excluir" {% if ride.exclude_from_reports %}checked{% endif %}>
      <label class="form-check-label" for="excluir">Excluir de relatórios</label>
    </div>
  </div>
  <div class="mt-3">
    <button class="btn btn-primary">Salvar alterações</button>
    <a href="{{ url_for('rides.calendar') }}" class="btn btn-secondary">Voltar ao calendário</a>
  </div>
</form>

<h2>Despesas da corrida</h2>
<form method="post" action="{{ url_for('rides.add_expense', ride_id=ride.id) }}" class="row g-3 align-items-end">
  <div class="col-md-3">
    <label class="form-label">Data</label>
    <input type="date" name="data" class="form-control" value="{{ ride.inicio.date().isoformat() }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">Tipo</label>
    <select name="tipo" class="form-select">
      <option value="combustivel">Combustível</option>
      <option value="pedagio">Pedágio</option>
      <option value="outros">Outros</option>
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Valor</label>
    <input type="number" step="0.01" name="valor" class="form-control" value="0">
  </div>
  <div class="col-md-3">
    <label class="form-label">Descrição (opcional)</label>
    <input name="descricao" class="form-control" placeholder="posto, estrada, nota...">
  </div>
  <div class="col-12"><button class="btn btn-success">Adicionar despesa</button></div>
</form>

<table class="table table-striped mt-3">
  <thead><tr><th>Data</th><th>Tipo</th><th>Descrição</th><th>Valor</th><th></th></tr></thead>
  <tbody>
  {% for d in despesas %}
    <tr>
      <td>{{ d.data.strftime('%d/%m/%Y') }}</td>
      <td>{{ d.tipo }}</td>
      <td>{{ d.descricao or '' }}</td>
      <td>${{ '%.2f'|format(d.valor) }}</td>
      <td>
        <form method="post" action="{{ url_for('rides.del_expense', ride_id=ride.id, exp_id=d.id) }}" onsubmit="return confirm('Remover despesa?')">
          <button class="btn btn-sm btn-outline-danger">Excluir</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
