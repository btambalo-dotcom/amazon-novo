{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <div class="btn-group">
    <a class="btn btn-outline-secondary" href="{{ url_for('rides.calendar', year=prev_month.year, month=prev_month.month) }}">« {{ '%02d' % prev_month.month }}/{{ prev_month.year }}</a>
    <a class="btn btn-outline-secondary" href="{{ url_for('rides.calendar', year=next_month.year, month=next_month.month) }}">{{ '%02d' % next_month.month }}/{{ next_month.year }} »</a>
  </div>
  <h1 class="m-0">Cal — {{ '%02d' % month }}/{{ year }}</h1>
  <div class="btn-group ms-2">
    <a class="btn btn-outline-secondary" href="{{ url_for('rides.index') }}">Lista</a>
    <a class="btn btn-outline-secondary active" href="{{ url_for('rides.calendar', year=year, month=month) }}">Calendário</a>
    <a class="btn btn-outline-secondary" href="{{ url_for('rides.agenda', year=year, month=month) }}">Agenda</a>
  </div>

  <a class="btn btn-primary" href="{{ url_for('rides.nova') }}">Nova corrida</a>
</div>
<div class="table-responsive mt-3">
<table class="table table-bordered align-middle text-center calendar">
  <thead class="table-secondary sticky-header">
    <tr>
      <th>Seg</th><th>Ter</th><th>Qua</th><th>Qui</th><th>Sex</th><th>Sáb</th><th>Dom</th>
    </tr>
  </thead>
  <tbody>
  {% for week in weeks %}
    <tr>
      {% for cell in week %}
        {% set d = cell.date %}
        <td class="text-start {{ 'other-month' if d.month != first.month else '' }}">
          <div class="small fw-bold">{{ d.day }}/{{ '%02d' % d.month }}</div>
          {% for r in cell.rides %}
            {% set total = (r.valor + r.gorjeta) %}
            {% set cls = 'total-low' if total < 50 else ('total-med' if total < 100 else 'total-high') %}
            <a class="badge-run {{ cls }} text-decoration-none" href="{{ url_for('rides.view', ride_id=r.id) }}">
              <div class="d-flex justify-content-between align-items-center"><span class="title">{{ r.titulo or 'Corrida' }}</span>
<form method="post" action="{{ url_for('rides.delete', ride_id=r.id) }}" onsubmit="return confirm('Excluir esta corrida? As despesas vinculadas também serão apagadas.');">
<button class="btn btn-sm btn-link text-danger p-0" title="Excluir">✕</button></form></div>
              <div>{{ r.inicio.strftime('%H:%M') }}–{{ r.fim.strftime('%H:%M') }}</div>
              <div>${{ '%.2f'|format(total) }}</div>
            </a>
          {% endfor %}
        </td>
      {% endfor %}
    </tr>
  {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}

<a class="btn btn-primary btn-lg btn-floating-new d-sm-none" href="{{ url_for('rides.nova') }}">Nova</a>
