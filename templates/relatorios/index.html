\
{% extends "base.html" %}
{% block content %}
<h1>Relatórios</h1>

<form class="row g-3" method="get">
  <div class="col-md-3">
    <label class="form-label">Início</label>
    <input type="date" name="inicio" class="form-control" value="{{ inicio|strftime('%Y-%m-%d') }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">Fim</label>
    <input type="date" name="fim" class="form-control" value="{{ fim|strftime('%Y-%m-%d') }}">
  </div>
  <div class="col-md-4">
    <label class="form-label">Estação</label>
    <select name="station_id" class="form-select">
      <option value="">Todas</option>
      {% for e in estacoes %}
        <option value="{{ e.id }}" {% if station_id and station_id==e.id %}selected{% endif %}>
          {{ e.nome }}{% if e.codigo %} ({{ e.codigo }}){% endif %}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2 d-flex align-items-end">
    <button class="btn btn-primary w-100">Filtrar</button>
  </div>
</form>

<hr>

<h4>Resumo do período</h4>
<ul>
  <li><strong>Receita:</strong> $ {{ '%.2f'|format(receita) }}</li>
  <li><strong>Custo:</strong> $ {{ '%.2f'|format(custo) }}</li>
  <li><strong>Lucro:</strong> $ {{ '%.2f'|format(lucro) }}</li>
  <li><strong>Margem:</strong> {{ '%.2f'|format(margem) }}%</li>
</ul>

<h4>Corridas consideradas (exclui as marcadas como "Tirar do relatório")</h4>
<table class="table table-sm table-striped">
  <thead><tr><th>Data</th><th>Estação</th><th>Horas</th><th>Valor</th><th>Gorjeta</th></tr></thead>
  <tbody>
  {% for r in rides %}
    <tr>
      <td>{{ r.inicio.strftime('%d/%m/%Y %H:%M') }} - {{ r.fim.strftime('%H:%M') }}</td>
      <td>{{ r.station.nome if r.station else '-' }}</td>
      <td>{{ '%.2f'|format(r.horas) }}</td>
      <td>${{ '%.2f'|format(r.valor) }}</td>
      <td>${{ '%.2f'|format(r.gorjeta) }}</td>
    </tr>
  {% else %}
    <tr><td colspan="5" class="text-center text-muted">Sem corridas no período.</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
