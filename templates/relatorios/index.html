{% extends 'base.html' %}
{% block content %}
<h1>Relatórios</h1>

<form class="row g-3 mb-3">
  <div class="col-md-3">
    <label class="form-label">Data inicial</label>
    <input class="form-control" type="date" name="start" value="{{ start.isoformat() }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">Data final</label>
    <input class="form-control" type="date" name="end" value="{{ end.isoformat() }}">
  </div>
  <div class="col-md-3 align-self-end">
    <button class="btn btn-primary">Aplicar filtro</button>
  </div>
  <div class="col-md-3 align-self-end">
    <a class="btn btn-outline-secondary" href="?month={{ month }}&year={{ start.year }}">Usar mês</a>
  </div>
</form>

<div class="row g-3">
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Corridas</div>
      <div class="h4">{{ count }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Horas</div>
      <div class="h4">{{ '%.2f'|format(horas) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Ganhos</div>
      <div class="h4">${{ '%.2f'|format(valor + gorjeta) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Despesas</div>
      <div class="h4">${{ '%.2f'|format(total_despesas) }}</div>
    </div></div>
  </div>
</div>

<div class="row g-3 mt-1">
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Lucro</div>
      <div class="h4">${{ '%.2f'|format(lucro) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Média por hora</div>
      <div class="h4">${{ '%.2f'|format(media_hora) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Média por corrida</div>
      <div class="h4">${{ '%.2f'|format(media_corrida) }}</div>
    </div></div>
  </div>
</div>

<h3 class="mt-4">Despesas por tipo</h3>
<table class="table table-sm table-striped" style="max-width:600px">
  <thead><tr><th>Tipo</th><th>Total</th></tr></thead>
  <tbody>
    <tr><td>Combustível</td><td>${{ '%.2f'|format(despesas.get('combustivel',0)) }}</td></tr>
    <tr><td>Pedágio</td><td>${{ '%.2f'|format(despesas.get('pedagio',0)) }}</td></tr>
    <tr><td>Outros</td><td>${{ '%.2f'|format(despesas.get('outros',0)) }}</td></tr>
  </tbody>
</table>

<h3 class="mt-4">Resumo por estação</h3>
<table class="table table-striped">
  <thead><tr><th>Estação</th><th>Corridas</th><th>Horas</th><th>Total (valor+gorjeta)</th></tr></thead>
  <tbody>
  {% for nome, qnt, h, total in por_estacao %}
    <tr>
      <td>{{ nome or '—' }}</td>
      <td>{{ qnt }}</td>
      <td>{{ '%.2f'|format(h) }}</td>
      <td>${{ '%.2f'|format(total) }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<h3 class="mt-4">Corridas do período</h3>
<table class="table table-striped">
  <thead><tr><th>Data</th><th>Início</th><th>Fim</th><th>Horas</th><th>Estação</th><th>Valor</th><th>Gorjeta</th><th>Total</th></tr></thead>
  <tbody>
  {% for r, s in corridas %}
    <tr>
      <td>{{ r.inicio.strftime('%d/%m/%Y') }}</td>
      <td>{{ r.inicio.strftime('%H:%M') }}</td>
      <td>{{ r.fim.strftime('%H:%M') }}</td>
      <td>{{ '%.2f'|format(r.horas) }}</td>
      <td>{{ s.nome if s else '—' }}</td>
      <td>${{ '%.2f'|format(r.valor) }}</td>
      <td>${{ '%.2f'|format(r.gorjeta) }}</td>
      <td>${{ '%.2f'|format(r.valor + r.gorjeta) }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
