{% extends 'base.html' %}
{% block content %}
<h1>Relatórios do mês</h1>
<form class="row g-3 mb-3">
  <div class="col-md-2">
    <label class="form-label">Mês</label>
    <input class="form-control" type="number" name="month" min="1" max="12" value="{{ month }}">
  </div>
  <div class="col-md-2">
    <label class="form-label">Ano</label>
    <input class="form-control" type="number" name="year" value="{{ year }}">
  </div>
  <div class="col-md-2 align-self-end">
    <button class="btn btn-primary">Aplicar</button>
  </div>
</form>

<div class="row g-3">
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Corridas</div>
      <div class="h4">{{ count }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Horas</div>
      <div class="h4">{{ '%.2f'|format(horas) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Ganhos (corridas + gorjetas)</div>
      <div class="h4">${{ '%.2f'|format(valor + gorjeta) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Despesas</div>
      <div class="h4">${{ '%.2f'|format(total_despesas) }}</div>
    </div></div>
  </div>
</div>

<div class="row g-3 mt-1">
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Lucro</div>
      <div class="h4">${{ '%.2f'|format(lucro) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Média por hora</div>
      <div class="h4">${{ '%.2f'|format(media_hora) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Média por corrida</div>
      <div class="h4">${{ '%.2f'|format(media_corrida) }}</div>
    </div></div>
  </div>
</div>

<h3 class="mt-4">Despesas por tipo</h3>
<table class="table table-sm table-striped" style="max-width:600px">
  <thead><tr><th>Tipo</th><th>Total</th></tr></thead>
  <tbody>
    <tr><td>Combustível</td><td>${{ '%.2f'|format(despesas.get('combustivel',0)) }}</td></tr>
    <tr><td>Pedágio</td><td>${{ '%.2f'|format(despesas.get('pedagio',0)) }}</td></tr>
    <tr><td>Outros</td><td>${{ '%.2f'|format(despesas.get('outros',0)) }}</td></tr>
  </tbody>
</table>

<h3 class="mt-4">Corridas do mês</h3>
<table class="table table-striped">
  <thead><tr><th>Data</th><th>Início</th><th>Fim</th><th>Horas</th><th>Valor</th><th>Gorjeta</th><th>Total</th></tr></thead>
  <tbody>
  {% for r in corridas %}
    <tr>
      <td>{{ r.inicio.strftime('%d/%m/%Y') }}</td>
      <td>{{ r.inicio.strftime('%H:%M') }}</td>
      <td>{{ r.fim.strftime('%H:%M') }}</td>
      <td>{{ '%.2f'|format(r.horas) }}</td>
      <td>${{ '%.2f'|format(r.valor) }}</td>
      <td>${{ '%.2f'|format(r.gorjeta) }}</td>
      <td>${{ '%.2f'|format(r.valor + r.gorjeta) }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
